{"version":3,"file":"build.js","sources":["../src/utils/world.js","../src/utils/display.js","../src/utils/game.js","../src/index.js"],"sourcesContent":["export default { generate, indexToPos, posToIndex, getNeighbors, getAt, setAt, contains }\n\nconst UP_LEFT    = [-1, -1]\nconst UP         = [ 0, -1]\nconst UP_RIGHT   = [ 1, -1]\nconst LEFT       = [-1,  0]\nconst RIGHT      = [ 1,  0]\nconst DOWN_LEFT  = [-1,  1]\nconst DOWN       = [ 0,  1]\nconst DOWN_RIGHT = [ 1,  1]\nconst directions = [UP_LEFT, UP, UP_RIGHT, LEFT, RIGHT, DOWN_LEFT, DOWN, DOWN_RIGHT]\n\nfunction generate(size) {\n\n  var area = size * size\n  var data = new Uint8ClampedArray(area)\n  var i = area\n  while (i--)\n    data[i] = Math.random() > 0.75\n\n  return data\n\n}\n\nfunction indexToPos(index, size) {\n  var x = index % size\n  var y = (index - x) / size\n  return [x, y]\n}\n\nfunction posToIndex(pos, size) {\n  var [x, y] = pos\n  return y * size + x\n}\n\nfunction getNeighbors(pos, size) {\n  if (!size)\n    return []\n  var neighbors = []\n  var [x, y] = pos\n  for (var direction of directions) {\n    var [dx, dy] = direction\n    var cx = x + dx\n    var cy = y + dy\n    if (cx < 0)\n      cx += size\n    if (cx >= size)\n      cx -= size\n    if (cy < 0)\n      cy += size\n    if (cy >= size)\n      cy -= size\n    var current = [cx, cy]\n    neighbors.push(current)\n  }\n  return neighbors\n}\n\nfunction getAt(data, pos, size) {\n  if (!size)\n    size = Math.sqrt(data.length)\n  if ( !contains(pos, size) )\n    return null\n  var index = posToIndex(pos, size)\n  return data[index]\n}\n\nfunction setAt(data, pos, id, size) {\n  if (!size)\n    size = Math.sqrt(data.length)\n  if ( !contains(pos, size) )\n    return null\n  var index = posToIndex(pos, size)\n  data[index] = id\n  return id\n}\n\nfunction contains(pos, size) {\n  var [x, y] = pos\n  return x >= 0 && y >= 0 && x < size && y < size\n}\n","function create(width, height) {\n\n  var _width  = width\n  var _height = height\n  if (!height)\n    if ( Array.isArray(width) )\n      [_width, _height] = width\n    else if ( !isNaN(width) )\n      _height = width\n\n  var _aspect = _width / _height\n  var _canvas = document.createElement('canvas')\n  var _canvasWidth  = _canvas.width  = _width\n  var _canvasHeight = _canvas.height = _height\n  var _context = _canvas.getContext('2d')\n  var _parent  = null\n  var _buffer  = null\n\n  function mount(parent) {\n    if (typeof parent === 'string')\n      parent = document.querySelector(parent)\n    if (!parent)\n      throw new TypeError(`Cannot mount display onto parent element '${parent}'`)\n    parent.appendChild(_canvas)\n    _parent = display.parent = parent\n    render()\n    return display\n  }\n\n  function clear() {\n    _context.fillStyle = 'black'\n    _context.fillRect(0, 0, _canvasWidth, _canvasHeight)\n  }\n\n  function render(buffer) {\n    if (!_buffer)\n      clear()\n    buffer = buffer || _buffer\n    if (!buffer)\n      return display\n\n    var imageData = _context.createImageData(_width, _height)\n    var data = imageData.data\n    var index = buffer.length\n    while (index--) {\n      var i = index * 4\n      var x = index % _width\n      var y = (index - x) / _width\n      var status = buffer[index]\n      var value = status ? 255 : 0\n      data[i]     = value\n      data[i + 1] = value\n      data[i + 2] = value\n      data[i + 3] = 255\n    }\n\n    _context.putImageData(imageData, 0, 0)\n\n    _buffer = buffer\n    return display\n  }\n\n  var display = { width: _width, height: _height, aspect: _aspect, context: _context, parent: _parent, mount, clear, render }\n  return display\n\n}\n\nexport default { create }\n","import { World, Display } from './index'\n\nconst DEAD = 0\nconst LIVE = 1\n\nfunction create(size, element) {\n\n  var world   = World.generate(size)\n  var display = Display.create(size).mount('#app').render(world)\n\n  function update(world, size) {\n    var result = []\n    var i = world.length\n    while (i--) {\n      var id = world[i]\n      var pos = World.indexToPos(i, size)\n      var neighbors = World.getNeighbors(pos, size)\n      var live = 0\n      for (var neighbor of neighbors)\n        if (World.getAt(world, neighbor, size) === LIVE)\n          live++\n      // Could abbreviate this using ternaries or raw booleans over here but it's better to keep it legible\n      if (id === LIVE)\n        if (live === 2 || live === 3)\n          id = LIVE\n        else\n          id = DEAD\n      else if (id === DEAD)\n        if (live === 3)\n          id = LIVE\n        else\n          id = DEAD\n        result[i] = id\n    }\n    return result\n  }\n\n  function tick() {\n    game.world = update(game.world, size)\n    display.render(game.world)\n  }\n\n  var game = { update, tick, size, world, display }\n  return game\n\n}\n\nexport default { create, DEAD, LIVE }\n","import { Game, World } from './utils/index'\n\nvar game = Game.create(128, '#app')\n\nfunction animate() {\n  if (!mouse.left && !mouse.right)\n    game.tick()\n  window.requestAnimationFrame(animate)\n}\n\nvar mouse = { left: false, right: false, cell: [] }\n\nvar parent = game.display.parent\nvar parentRect = parent.getBoundingClientRect()\n\nparent.addEventListener('contextmenu', onContextMenu)\nparent.addEventListener('mousemove',   onMouseMove)\nparent.addEventListener('mousedown',   onMouseClick)\nwindow.addEventListener('mouseup',     onMouseClick)\n\nfunction onMouseMove(event) {\n  var { offsetX: x, offsetY: y } = event\n  var cell = mouse.cell = [ Math.round(x / parentRect.width  * game.size), Math.round(y / parentRect.height * game.size) ]\n  var [cellX, cellY] = cell\n  var value = null\n  if (mouse.left)\n    value = Game.LIVE\n  else if (mouse.right)\n    value = Game.DEAD\n  if (mouse.left || mouse.right) {\n    var index = World.posToIndex(cell, game.size)\n    game.world[index] = value\n    game.display.render(game.world)\n  }\n}\n\nfunction onMouseClick(event) {\n  var isMouseDown = event.type === 'mousedown'\n  var button = event.button\n  if (button === 0)\n    mouse.left  = isMouseDown\n  if (button === 2)\n    mouse.right = isMouseDown\n  if (isMouseDown) {\n    parentRect = parent.getBoundingClientRect()\n    onMouseMove(event)\n  }\n}\n\nfunction onContextMenu(event) {\n  event.preventDefault()\n}\n\nanimate()\n"],"names":["generate","indexToPos","posToIndex","getNeighbors","getAt","setAt","contains","UP_LEFT","UP","UP_RIGHT","LEFT","RIGHT","DOWN_LEFT","DOWN","DOWN_RIGHT","directions","size","area","data","Uint8ClampedArray","i","Math","random","index","x","y","pos","neighbors","direction","dx","dy","cx","cy","current","push","sqrt","length","id","create","width","height","_width","_height","Array","isArray","isNaN","_aspect","_canvas","document","createElement","_canvasWidth","_canvasHeight","_context","getContext","_parent","_buffer","mount","parent","querySelector","TypeError","appendChild","display","clear","fillStyle","fillRect","render","buffer","imageData","createImageData","status","value","putImageData","aspect","context","DEAD","LIVE","element","world","World","Display","update","result","live","neighbor","tick","game","Game","animate","mouse","left","right","requestAnimationFrame","cell","parentRect","getBoundingClientRect","addEventListener","onContextMenu","onMouseMove","onMouseClick","window","event","offsetX","offsetY","round","cellX","cellY","isMouseDown","type","button","preventDefault"],"mappings":"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"}